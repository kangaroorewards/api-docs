
# Access Kangaroo Rewards REST API

The Kangaroo Rewards API allows you to manage resources in a simple, programmatic way using conventional
HTTP requests. The endpoints are intuitive and powerful, allowing you to easily make calls to retrieve
information.

All of the functionality that you are familiar with in the Kangaroo Rewards App is also available
through the API, allowing you to script the complex actions that your situation requires.

>**Note:** The X-Application-Key header is required for all requests

> **NOTE:** All POST, PUT and PATCH requests MUST have the content type header set to `application/json`

```
PUT /users/me/settings/notifications HTTP/1.1
Host: api.kangaroorewards.com
Accept: application/vnd.kangaroorewards.api.v1+json;
X-Application-Key: eyJ0eXAi...
Authorization: Bearer eyJ0eXAiOiJKV1QiL...
Content-Type: application/json; charset=UTF-8
```

## Requests

<table class="table">
    <tr class="bg-primary">
        <th>Method</th> <th>Usage</th>
    </tr>
    <tr>
        <td><strong>GET</strong></td>
        <td>
            For simple retrieval of information about your account, offers, customers etc., you should use the GET method. The information you request will be returned to you as a JSON object.
            The attributes defined by the JSON object can be used to form additional requests. Any request using the GET method is read-only and will not affect any of the objects you are querying.
        </td>
    </tr>
    <tr>
        <td><strong>POST</strong></td>
        <td>
            To create a new object, your request should specify the POST method.
            The POST request includes all of the attributes necessary to create a new object. When you wish to create a new object, send a POST request to the target endpoint.
        </td>
    </tr>
    <tr>
        <td><strong>PUT</strong></td>
        <td>To update the information about a resource in your account, the PUT method is available.</td>
    </tr>
    <tr>
        <td><strong>DELETE</strong></td>
        <td>To destroy a resource and remove it from your account, the DELETE method should be used. This will remove the specified object if it is found. If it is not found, the operation will return a response indicating that the object was not found (404 error code).</td>
    </tr>
</table>

## HTTP Statuses

Along with the HTTP methods that the API responds to, it will also return standard HTTP statuses, including
error codes.

In the event of a problem, the status will contain the error code, while the body of the response will
usually contain additional information about the problem that was encountered.

In general, if the status returned is in the `200` range, it indicates that the request was fulfilled
successfully and that no error was encountered.

Return codes in the `400` range typically indicate that there was an issue with the request that was sent.
Among other things, this could mean that you did not authenticate correctly, that you are requesting an action that you do not have authorization for, that the object you are requesting does not exist, or that your request is malformed.

If you receive a status in the `500` range, this generally indicates a server-side problem. This means that
we are having an issue on our end and cannot fulfill your request currently.

### Common HTTP Status Codes

<table class="table">
    <tr class="bg-primary">
        <th>Status Code</th> <th>Description</th> <th>Common Causes</th>
    </tr>
    <tr>
        <td><strong>200 OK</strong></td>
        <td>The request was successful</td>
        <td>Standard response for successful HTTP requests</td>
    </tr>
    <tr>
        <td><strong>201 Created</strong></td>
        <td>The request was successful and a resource was created</td>
        <td>Returned when a POST request successfully creates a new resource</td>
    </tr>
    <tr>
        <td><strong>204 No Content</strong></td>
        <td>The request was successful but there is no content to return</td>
        <td>Common response for successful DELETE operations</td>
    </tr>
    <tr>
        <td><strong>400 Bad Request</strong></td>
        <td>The request was malformed or invalid</td>
        <td>Missing required fields, invalid JSON format, or incorrect parameter types</td>
    </tr>
    <tr>
        <td><strong>401 Unauthorized</strong></td>
        <td>Authentication is required and has failed or not been provided</td>
        <td>Missing or invalid access token, expired token</td>
    </tr>
    <tr>
        <td><strong>403 Forbidden</strong></td>
        <td>The request is valid but the server is refusing to respond</td>
        <td>Insufficient permissions to access the resource or perform the action</td>
    </tr>
    <tr>
        <td><strong>404 Not Found</strong></td>
        <td>The requested resource could not be found</td>
        <td>Invalid resource ID, resource has been deleted, or incorrect endpoint URL</td>
    </tr>
    <tr>
        <td><strong>422 Unprocessable Entity</strong></td>
        <td>The request was well-formed but contains semantic errors</td>
        <td>Validation errors, business rule violations, or invalid data combinations</td>
    </tr>
    <tr>
        <td><strong>429 Too Many Requests</strong></td>
        <td>Rate limit has been exceeded</td>
        <td>Too many requests in a given time period. See Rate Limit section for details</td>
    </tr>
    <tr>
        <td><strong>500 Internal Server Error</strong></td>
        <td>An error occurred on the server</td>
        <td>Unexpected server-side error. Contact support if this persists</td>
    </tr>
    <tr>
        <td><strong>503 Service Unavailable</strong></td>
        <td>The service is temporarily unavailable</td>
        <td>Server maintenance or temporary overload. Retry after a delay</td>
    </tr>
</table>

### Error Response Format

When an error occurs, the API returns a JSON response with details about the error:

**Example 400 Bad Request Response:**
```json
{
  "error": {
    "status_code": 400,
    "message": "Invalid ID supplied",
    "description": "Bad Request"
  }
}
```

**Example 401 Unauthorized Response:**
```json
{
  "error": {
    "status_code": 401,
    "message": "Unauthenticated",
    "description": "The access token is invalid or has expired"
  }
}
```

**Example 422 Validation Error Response:**
```json
{
  "email": [
    "The email field is required"
  ],
  "phone": [
    "The phone field must be a valid phone number"
  ]
}
```

## Responses

When a request is successful, a response body will typically be sent back in the form of a JSON object. An exception to this is when a DELETE request is processed, which will result in a successful HTTP 204 status and an empty response body.

**Example Response**
```
{
    "data": {
        "name": "john"
        . . .
    }
}
```

## Meta
In addition to the main resource root, the response MAY also contain a **meta** object. This object contains information about the response itself.
The **meta** object MIGHT contain a **total** key that is set to the total number of objects returned by the request. This has implications on the pagination.
The **meta** object MIGHT not be presend or it will only be displayed when it has a value. Currently, the meta object will have a value when a request is made on a collection (like customers).

## Pagination
The **meta** object is returned as part of the response body when pagination is enabled. By default, 100 objects are returned per page.
You can request a different page by appending ?page= to the request. For instance, to navigate to page 2, you could add ?page=2 to the end of your query

Example:
```
{
    "data": {
        . . .
    },
    "meta": {
        "total": 509
    }
}
```

## Rate Limit

The number of requests that can be made through the API is currently limited to 240 per minute per OAuth token or IP.
The rate limiting information is contained within the response headers of each request. The relevant headers are:

- **X-RateLimit-Limit** - The number of requests that can be made per minute.
- **X-RateLimit-Remaining** - The number of requests that remain before you hit your request limit.
- **X-RateLimit-Reset** - This represents the time when you are allowed to make requests again. The value
- is given in [Unix epoch time](http://en.wikipedia.org/wiki/Unix_time "Unix epoch time") You'll only get **X-RateLimit-Reset** if you've hit the limit

Example
```
X-RateLimit-Limit: 239
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1476571703
```

# Best Practices

- **Read the Documentation:** Understand the API's endpoints, parameters, authentication methods, rate limits, and response formats.
- **Authenticate Properly:** Use the correct authentication method (e.g., OAuth2 Password Credentials, Authorization Code) and handle authentication securely.
- **Respect Rate Limits:** Adhere to the API's rate limits to avoid being throttled or blocked. Implement backoff strategies if rate limits are exceeded.
- **Refresh Tokens:** When using OAuth for authentication, especially for long-lived sessions or when accessing resources on behalf of a user, utilize refresh tokens. These tokens can be exchanged for new access tokens once they expire, without requiring the user to reauthenticate. This ensures uninterrupted access to the API while maintaining security.
- **Error Handling:** Handle errors gracefully by checking for error responses and implementing appropriate error-handling mechanisms.
- **Security:** Ensure data security by using `HTTPS`, validating user input, and sanitizing data to prevent injection attacks.
- **Versioning:** Keep track of API version changes and update your code accordingly to maintain compatibility.
- **Optimize Requests:** Minimize unnecessary requests by batching or caching data when possible to reduce latency and improve performance.
- **Monitor Usage:** Monitor API usage to identify any issues or performance bottlenecks and optimize accordingly.
- **Handle Pagination:** Implement pagination when working with large datasets to retrieve data efficiently in manageable chunks.
- **Feedback and Support:** Provide feedback on usability, documentation, and feature requests. Utilize support channels if you encounter issues or have questions.

By following these best practices, you can ensure efficient, secure, and reliable integration with Kangaroo Rewards' APIs.

# Code Examples

This section provides practical code examples for common operations in multiple programming languages.

## Making API Requests

### PHP

```php
<?php
// Using cURL to make API requests
$accessToken = 'your_access_token_here';
$appKey = 'your_application_key_here';

$ch = curl_init('https://api.kangaroorewards.com/customers');
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Authorization: Bearer ' . $accessToken,
    'X-Application-Key: ' . $appKey,
    'Accept: application/vnd.kangaroorewards.api.v1+json',
    'Content-Type: application/json'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$statusCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
curl_close($ch);

if ($statusCode === 200) {
    $customers = json_decode($response, true);
    print_r($customers);
} else {
    echo "Error: " . $statusCode . "\n";
    echo $response;
}
?>
```

### Python

```python
import requests

# Configuration
access_token = 'your_access_token_here'
app_key = 'your_application_key_here'
base_url = 'https://api.kangaroorewards.com'

# Set up headers
headers = {
    'Authorization': f'Bearer {access_token}',
    'X-Application-Key': app_key,
    'Accept': 'application/vnd.kangaroorewards.api.v1+json',
    'Content-Type': 'application/json'
}

# Make GET request
response = requests.get(f'{base_url}/customers', headers=headers)

if response.status_code == 200:
    customers = response.json()
    print(customers)
else:
    print(f'Error: {response.status_code}')
    print(response.text)
```

### JavaScript (Node.js)

```javascript
const axios = require('axios');

// Configuration
const accessToken = 'your_access_token_here';
const appKey = 'your_application_key_here';
const baseURL = 'https://api.kangaroorewards.com';

// Set up axios instance
const api = axios.create({
  baseURL: baseURL,
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'X-Application-Key': appKey,
    'Accept': 'application/vnd.kangaroorewards.api.v1+json',
    'Content-Type': 'application/json'
  }
});

// Make GET request
api.get('/customers')
  .then(response => {
    console.log(response.data);
  })
  .catch(error => {
    console.error('Error:', error.response?.status);
    console.error(error.response?.data);
  });
```

### Ruby

```ruby
require 'net/http'
require 'json'
require 'uri'

# Configuration
access_token = 'your_access_token_here'
app_key = 'your_application_key_here'
base_url = 'https://api.kangaroorewards.com'

# Make GET request
uri = URI("#{base_url}/customers")
request = Net::HTTP::Get.new(uri)
request['Authorization'] = "Bearer #{access_token}"
request['X-Application-Key'] = app_key
request['Accept'] = 'application/vnd.kangaroorewards.api.v1+json'
request['Content-Type'] = 'application/json'

response = Net::HTTP.start(uri.hostname, uri.port, use_ssl: true) do |http|
  http.request(request)
end

if response.code == '200'
  customers = JSON.parse(response.body)
  puts customers
else
  puts "Error: #{response.code}"
  puts response.body
end
```

## Creating a Customer

### PHP

```php
<?php
$customerData = [
    'email' => 'newcustomer@example.com',
    'first_name' => 'Jane',
    'last_name' => 'Smith',
    'phone' => '5551234567',
    'country_code' => 'US'
];

$ch = curl_init('https://api.kangaroorewards.com/customers');
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($customerData));
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Authorization: Bearer ' . $accessToken,
    'X-Application-Key: ' . $appKey,
    'Accept: application/vnd.kangaroorewards.api.v1+json',
    'Content-Type: application/json'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$statusCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
curl_close($ch);

if ($statusCode === 200) {
    $customer = json_decode($response, true);
    echo "Customer created: " . $customer['data']['id'];
} else {
    echo "Error: " . $statusCode;
}
?>
```

### Python

```python
customer_data = {
    'email': 'newcustomer@example.com',
    'first_name': 'Jane',
    'last_name': 'Smith',
    'phone': '5551234567',
    'country_code': 'US'
}

response = requests.post(
    f'{base_url}/customers',
    headers=headers,
    json=customer_data
)

if response.status_code == 200:
    customer = response.json()
    print(f"Customer created: {customer['data']['id']}")
else:
    print(f'Error: {response.status_code}')
    print(response.json())
```

### JavaScript (Node.js)

```javascript
const customerData = {
  email: 'newcustomer@example.com',
  first_name: 'Jane',
  last_name: 'Smith',
  phone: '5551234567',
  country_code: 'US'
};

api.post('/customers', customerData)
  .then(response => {
    console.log(`Customer created: ${response.data.data.id}`);
  })
  .catch(error => {
    console.error('Error:', error.response?.status);
    console.error(error.response?.data);
  });
```

## Handling Pagination

### Python Example

```python
def get_all_customers(base_url, headers):
    """Fetch all customers across multiple pages"""
    all_customers = []
    page = 1
    
    while True:
        response = requests.get(
            f'{base_url}/customers',
            headers=headers,
            params={'page': page}
        )
        
        if response.status_code != 200:
            break
            
        data = response.json()
        customers = data.get('data', [])
        
        if not customers:
            break
            
        all_customers.extend(customers)
        
        # Check if there are more pages
        cursor = data.get('cursor', {})
        if not cursor.get('next'):
            break
            
        page += 1
    
    return all_customers

# Usage
all_customers = get_all_customers(base_url, headers)
print(f"Total customers: {len(all_customers)}")
```

### JavaScript Example

```javascript
async function getAllCustomers() {
  let allCustomers = [];
  let page = 1;
  let hasMore = true;

  while (hasMore) {
    try {
      const response = await api.get('/customers', {
        params: { page }
      });

      const customers = response.data.data || [];
      allCustomers = allCustomers.concat(customers);

      // Check if there are more pages
      hasMore = response.data.cursor?.next !== undefined;
      page++;
    } catch (error) {
      console.error('Error fetching customers:', error);
      hasMore = false;
    }
  }

  return allCustomers;
}

// Usage
getAllCustomers().then(customers => {
  console.log(`Total customers: ${customers.length}`);
});
```

## Error Handling Best Practices

### Python with Retry Logic

```python
import time
from requests.adapters import HTTPAdapter
from requests.packages.urllib3.util.retry import Retry

def create_session_with_retries():
    """Create a requests session with automatic retry logic"""
    session = requests.Session()
    
    # Configure retry strategy
    retry_strategy = Retry(
        total=3,  # Total number of retries
        backoff_factor=1,  # Wait 1, 2, 4 seconds between retries
        status_forcelist=[429, 500, 502, 503, 504],
        method_whitelist=["GET", "POST", "PUT", "DELETE"]
    )
    
    adapter = HTTPAdapter(max_retries=retry_strategy)
    session.mount("https://", adapter)
    session.mount("http://", adapter)
    
    return session

# Usage
session = create_session_with_retries()
session.headers.update(headers)

try:
    response = session.get(f'{base_url}/customers')
    response.raise_for_status()
    customers = response.json()
except requests.exceptions.RequestException as e:
    print(f"Request failed: {e}")
```

### JavaScript with Error Handling

```javascript
async function makeApiCallWithErrorHandling(endpoint, method = 'GET', data = null) {
  try {
    const config = {
      method,
      url: endpoint,
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'X-Application-Key': appKey,
        'Accept': 'application/vnd.kangaroorewards.api.v1+json',
        'Content-Type': 'application/json'
      }
    };

    if (data) {
      config.data = data;
    }

    const response = await axios(config);
    return { success: true, data: response.data };
    
  } catch (error) {
    if (error.response) {
      // The request was made and the server responded with a status code
      // that falls out of the range of 2xx
      switch (error.response.status) {
        case 401:
          console.error('Unauthorized: Token may be expired');
          // Implement token refresh logic here
          break;
        case 429:
          console.error('Rate limit exceeded. Retry after delay');
          // Implement backoff logic here
          break;
        case 422:
          console.error('Validation error:', error.response.data);
          break;
        default:
          console.error(`Error ${error.response.status}:`, error.response.data);
      }
    } else if (error.request) {
      // The request was made but no response was received
      console.error('No response received from server');
    } else {
      // Something happened in setting up the request
      console.error('Error setting up request:', error.message);
    }
    
    return { success: false, error: error.message };
  }
}

// Usage
const result = await makeApiCallWithErrorHandling('/customers');
if (result.success) {
  console.log('Customers:', result.data);
} else {
  console.error('Failed to fetch customers');
}
```

# Troubleshooting

This section covers common issues and their solutions when working with the Kangaroo Rewards API.

## Authentication Issues

**Problem: 401 Unauthorized Error**

*Symptoms:* Receiving a 401 status code when making API requests.

*Common Causes & Solutions:*
- **Expired Access Token:** Access tokens expire after 24 hours. Use the refresh token to obtain a new access token.
- **Missing Authorization Header:** Ensure your request includes the `Authorization: Bearer <access_token>` header.
- **Invalid Token Format:** Verify that the token is properly formatted and not corrupted.
- **Revoked Access:** The user may have revoked your application's access. Request new authorization.

**Example Fix:**
```bash
# Refresh the access token
curl -X POST https://api.kangaroorewards.com/oauth/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -H "X-Application-Key: YOUR_APP_KEY" \
  -d "grant_type=refresh_token" \
  -d "refresh_token=YOUR_REFRESH_TOKEN" \
  -d "client_id=YOUR_CLIENT_ID" \
  -d "client_secret=YOUR_CLIENT_SECRET" \
  -d "scope=admin"
```

**Problem: 403 Forbidden Error**

*Symptoms:* Request is authenticated but access is denied.

*Common Causes & Solutions:*
- **Insufficient Permissions:** The access token doesn't have the required scope. Request authorization with the appropriate scope (e.g., `admin`).
- **Application Not Approved:** Contact Kangaroo Rewards Support to get your application approved.
- **Resource Access Restrictions:** You may be trying to access resources that don't belong to the authenticated account.

## Rate Limiting Issues

**Problem: 429 Too Many Requests**

*Symptoms:* Receiving a 429 status code after multiple API calls.

*Solution:*
Implement exponential backoff and respect the rate limit headers:

```javascript
// Example: Handle rate limiting with exponential backoff
async function apiCallWithRetry(url, options, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    const response = await fetch(url, options);
    
    if (response.status === 429) {
      const resetTime = response.headers.get('X-RateLimit-Reset');
      const waitTime = Math.min(Math.pow(2, i) * 1000, 60000); // Max 60s
      console.log(`Rate limited. Waiting ${waitTime}ms before retry...`);
      await new Promise(resolve => setTimeout(resolve, waitTime));
      continue;
    }
    
    return response;
  }
  throw new Error('Max retries exceeded');
}
```

## Validation Errors

**Problem: 422 Unprocessable Entity**

*Symptoms:* Request is well-formed but contains validation errors.

*Common Causes & Solutions:*
- **Missing Required Fields:** Check that all required fields are included in your request body.
- **Invalid Data Format:** Ensure dates are in ISO 8601 format, emails are valid, phone numbers include country codes, etc.
- **Business Rule Violations:** Review the error response for specific validation messages.

**Example Error Response:**
```json
{
  "email": ["The email field is required"],
  "country_code": ["The country code field is required when phone is present"]
}
```

## Common Request Issues

**Problem: Missing X-Application-Key Header**

*Solution:* All requests must include the `X-Application-Key` header. Obtain your application key from the business portal.

```bash
curl -X GET https://api.kangaroorewards.com/customers \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "X-Application-Key: YOUR_APP_KEY" \
  -H "Accept: application/vnd.kangaroorewards.api.v1+json"
```

**Problem: Incorrect Content-Type Header**

*Solution:* All POST, PUT, and PATCH requests must have `Content-Type: application/json` header.

```bash
curl -X POST https://api.kangaroorewards.com/customers \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "X-Application-Key: YOUR_APP_KEY" \
  -H "Content-Type: application/json" \
  -H "Accept: application/vnd.kangaroorewards.api.v1+json" \
  -d '{"email":"customer@example.com","first_name":"John"}'
```

## Pagination Issues

**Problem: Not All Data Returned**

*Solution:* The API returns paginated results (default 100 items per page). Use the `page` parameter to retrieve additional pages.

```bash
# Get first page
GET /customers?page=1

# Get second page
GET /customers?page=2

# Check meta.total to know the total count
```

## Debugging Tips

1. **Enable Verbose Logging:** Use curl's `-v` flag to see full request/response headers:
   ```bash
   curl -v -X GET https://api.kangaroorewards.com/customers ...
   ```

2. **Validate JSON:** Use online JSON validators to ensure your request body is valid JSON.

3. **Check Response Headers:** Rate limit information and error details are often in response headers.

4. **Test with Simple Requests:** Start with basic GET requests before attempting complex POST/PUT operations.

5. **Review API Version:** Ensure you're using the correct API version in the Accept header:
   ```
   Accept: application/vnd.kangaroorewards.api.v1+json
   ```

## Getting Help

If you continue to experience issues:

- Check the [API Documentation](https://api.kangaroorewards.com/docs) for endpoint-specific requirements
- Review [Tutorials](https://github.com/kangaroorewards/api-docs/wiki) for common use cases
- Contact Kangaroo Rewards Support with:
  - Request/response details (remove sensitive data)
  - Timestamps of the issue
  - Your application ID
  - Description of what you're trying to accomplish

